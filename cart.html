<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Cart APEXIA</title>
    <meta name="description" content="–ö–æ—à–∏–∫ —Ç–æ–≤–∞—Ä—ñ–≤ APEXIA">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='cart.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}?v=1">
</head>
<body>
    <header>
        <h1>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</h1>
        <h1 style="color: rgb(64, 79, 63); background-color: rgb(252, 0, 0);  border-radius: 10px; box-shadow: 0px 0px 17px rgba(171, 213, 130, 0.8);">
            –°–∞–π—Ç –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Ç–µ—Å—Ç–æ–≤–æ–º—É —Ä–µ–∂–∏–º—ñ, –Ω—ñ—á–æ–≥–æ –Ω–µ –∫—É–ø–ª—è—Ç–∏!\ The site is in test mode, do not buy anything!  üòé
        </h1>
    </header>

    <main>
        <div id="cart-items">
            <!-- –¢–æ–≤–∞—Ä–∏ –±—É–¥—É—Ç—å –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ -->
        </div>
        <div id="cart-summary">
            <p>–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞: <span id="cart-total">‚Ç¥0.00</span></p>
        </div>
        <button id="checkout" disabled>–û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
        <button 
            style="color: rgb(255, 255, 255); background-color: rgb(53, 134, 13); font-size: 18px; padding: 12px 20px; border-radius: 8px; border: none; cursor: pointer; margin-top: 5px;"
            onclick="window.history.back()">‚û• –ù–∞–∑–∞–¥
        </button>
    </main>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            let cart = JSON.parse(localStorage.getItem("cart")) || {};
            const cartItemsContainer = document.getElementById("cart-items");
            const cartTotalElement = document.getElementById("cart-total");
            const checkoutButton = document.getElementById("checkout");
    
            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ—à–∏–∫–∞
            const updateCart = () => {
                cartItemsContainer.innerHTML = ""; // –û—á–∏—â—É—î–º–æ –≤–º—ñ—Å—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                let totalAmount = 0;
    
                if (Object.keys(cart).length === 0) {
                    cartItemsContainer.innerHTML = "<p>–í–∞—à –∫–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π. –î–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä–∏!</p>";
                    cartTotalElement.textContent = "‚Ç¥0.00";
                    checkoutButton.disabled = true;
                } else {
                    for (const productId in cart) {
                        const item = cart[productId];
                        if (!item.name || !item.price || item.quantity <= 0) continue;
    
                        const itemDiv = document.createElement("div");
                        itemDiv.classList.add("cart-item");
                        itemDiv.innerHTML = `
                            <span class="item-name">${item.name}</span>
                            <div class="item-quantity-controls">
                                <button class="decrease-quantity" data-product-id="${productId}">-</button>
                                <span class="item-quantity">${item.quantity}</span>
                                <button class="increase-quantity" data-product-id="${productId}">+</button>
                            </div>
                            <span class="item-price">‚Ç¥${(item.price * item.quantity).toFixed(2)}</span>
                            <button class="remove-item" data-product-id="${productId}">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                        `;
                        cartItemsContainer.appendChild(itemDiv);
                        totalAmount += item.price * item.quantity;
                    }
                    cartTotalElement.textContent = `‚Ç¥${totalAmount.toFixed(2)}`;
                    checkoutButton.disabled = false;
                }
    
                localStorage.setItem("cart", JSON.stringify(cart)); // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –∫–æ—à–∏–∫
            };
    
            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—è –∫–æ—à–∏–∫–∞
            const clearCart = () => {
                if (confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤–µ—Å—å –∫–æ—à–∏–∫?")) {
                    cart = {}; // –û—á–∏—â—É—î–º–æ –ª–æ–∫–∞–ª—å–Ω–∏–π –æ–±'—î–∫—Ç –∫–æ—à–∏–∫–∞
                    localStorage.removeItem("cart"); // –í–∏–¥–∞–ª—è—î–º–æ –¥–∞–Ω—ñ –∑ LocalStorage
                    window.location.href = '/donate';
                    updateCart(); // –û–Ω–æ–≤–ª—é—î–º–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                }
            };
    
            // –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ "–û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è"
            checkoutButton.addEventListener("click", () => {
                localStorage.setItem("cart", JSON.stringify(cart)); // –ì–∞—Ä–∞–Ω—Ç—É—î–º–æ, —â–æ –∫–æ—à–∏–∫ –∑–±–µ—Ä–µ–∂–µ–Ω–æ
                window.location.href = '/payment'; // –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –æ–ø–ª–∞—Ç–∏
            });
    
            cartItemsContainer.addEventListener("click", (event) => {
                const productId = event.target.dataset.productId;
                if (!productId) return;
    
                if (event.target.classList.contains("remove-item")) {
                    delete cart[productId];
                    updateCart();
                } else if (event.target.classList.contains("increase-quantity")) {
                    cart[productId].quantity += 1;
                    updateCart();
                } else if (event.target.classList.contains("decrease-quantity")) {
                    cart[productId].quantity -= 1;
                    if (cart[productId].quantity <= 0) delete cart[productId];
                    updateCart();
                }
            });
    
            updateCart(); // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–æ—à–∏–∫–∞
        });
    </script>
</body>
</html>