<!DOCTYPE html>
<html lang="uk">
  <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>APEXIA Store</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="{{ url_for('static', filename='donate.css') }}">
        <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}?v=1">
 </head>
    <body>
        <header>
            <nav> 
                <ul>
                    <li><a href="{{ url_for('home') }}">Головна</a></li>
                    <li><a href="{{ url_for('carsDeerisle') }}">Автівки</a></li>
                    <li><a href="{{ url_for('trucksDeerisle') }}">Вантажівки</a></li>
                    <li><a href="{{ url_for('helicoptersDeerisle') }}">Гвинтокрили</a></li>
                    <!--<li><a href="{{ url_for('clothingDeerisle') }}">Комплект одягу</a></li>-->
                    <li><a href="{{ url_for('basesDeerisle') }}">Бази</a></li>
                </ul>
            </nav>
            {% if user %}
            <div class="user-info">
                <a href="/profile">
                   <img src="{{ user.profile_image_url }}"
                    alt="Фото профілю" 
                    class="profile-image">
                </a>
                <div class="info-span">
                    <span>{{ user.name }}</span> 
                </div>
                <div class="cart-panel">
                    <a href="/cart" class="cart-button">
                        <img src="{{ url_for('static', filename='shopping-shop.png') }}" 
                             alt="Кошик" class="cart-icon">
                        <span id="cart-count">0</span>
                    </a>
                </div>
            </div> 
            {% endif %}
        </header>   
        <main>
            <!-- Бази -->
            <section id="bases" class="category">
                <div class="products">
                    
                    <div class="product">
                        <img src="{{ url_for('static', filename='Insurance-against-destruction-on-wipes-Base.webp') }}" alt="Base 1">
                        <h3>Страхування від знищень на вайп Бази</h3>
                        <p class="promo-stock" data-product="Insurance-against-destruction-on-wipes-Base">Завантаження...</p>
                        <div class="quantity-control">
                            <button class="decrement">-</button>
                              <span class="quantity" data-product-id="57">1</span>
                            <button class="increment">+</button>
                        </div>
                        <h3>Ціна: ₴150</h3>
                        <button class="buy" 
                            data-product-id="57" 
                            data-product-name="ULTRA base" 
                            data-product-price="150">
                            Придбати
                        </button>
                    </div>

                    <div class="product">
                        <img src="{{ url_for('static', filename='ULTRA base1.png') }}" alt="Base 2">
                        <img src="{{ url_for('static', filename='ULTRA base2.png') }}">
                        <img src="{{ url_for('static', filename='ULTRA base3.png') }}">
                        <img src="{{ url_for('static', filename='ULTRA base4.png') }}">
                        <img src="{{ url_for('static', filename='ULTRA base5.png') }}">
                        <h3>База ULTRA</h3>
                        <p>В комплект до бази:</p>
                        <p>Бочка х2, Code Lock, Пачка цвяхів х3, Молоток,</p>
                        <p>Кувалда, Генератор, Будівельна лампа, Катушка.</p>
                        <h3>Увага!</h3>
                        <p>Після оплати замовлення, створіть тікет в</p>
                        <p>Discord, для уточнення даних із адміністрацією.</p>
                        <p class="promo-stock" data-product="BaseDeerisle">Завантаження...</p>                        
                        <div class="quantity-control">
                            <button class="decrement">-</button>
                              <span class="quantity" data-product-id="58">1</span>
                            <button class="increment">+</button>
                        </div>
                        <h3>Ціна: ₴1800</h3>
                        <button class="buy" 
                            data-product-id="58" 
                            data-product-name="ULTRA base" 
                            data-product-price="1800">
                            Придбати
                        </button>
                    </div>

                    
                    <div class="product">
                        <img src="{{ url_for('static', filename='MAX base1.webp') }}" alt="Base 3">
                        <img src="{{ url_for('static', filename='MAX base2.webp') }}">
                        <img src="{{ url_for('static', filename='MAX base3.webp') }}">
                        <img src="{{ url_for('static', filename='MAX base4.webp') }}">
                        <h3>База MAX</h3>
                        <p>В комплект до бази:</p>
                        <p>Бочка х2, Code Lock, Пачка цвяхів х3, Молоток,</p>
                        <p>Кувалда, Генератор, Будівельна лампа, Катушка.</p>
                        <h3>Увага!</h3>
                        <p>Після оплати замовлення, створіть тікет в</p>
                        <p>Discord, для уточнення даних із адміністрацією.</p>
                        <p class="promo-stock" data-product="BaseDeerisle">Завантаження...</p>
                        <div class="quantity-control">
                            <button class="decrement">-</button>
                              <span class="quantity" data-product-id="59">1</span>
                            <button class="increment">+</button>
                        </div>
                        <h3>Ціна: ₴1200</h3>
                        <button class="buy" 
                            data-product-id="59" 
                            data-product-name="MAX base" 
                            data-product-price="1200">
                            Придбати
                        </button>
                    </div>

                    
                    <div class="product">
                        <img src="{{ url_for('static', filename='HOTEL base1.png') }}" alt="Base 4">
                        <img src="{{ url_for('static', filename='HOTEL base2.png') }}">
                        <img src="{{ url_for('static', filename='HOTEL base3.png') }}">
                        <h3>База HOTEL</h3>
                        <p>В комплект до бази:</p>
                        <p>Бочка х2, Code Lock, Пачка цвяхів х3, Молоток,</p>
                        <p>Кувалда, Генератор, Будівельна лампа, Катушка.</p>
                        <h3>Увага!</h3>
                        <p>Після оплати замовлення, створіть тікет в</p>
                        <p>Discord, для уточнення даних із адміністрацією.</p>
                        <p class="promo-stock" data-product="BaseDeerisle">Завантаження...</p>                      
                        <div class="quantity-control">
                            <button class="decrement">-</button>
                              <span class="quantity" data-product-id="60">1</span>
                            <button class="increment">+</button>
                        </div>
                        <h3>Ціна: ₴900</h3>
                        <button class="buy" 
                            data-product-id="60" 
                            data-product-name="HOTEL base" 
                            data-product-price="900">
                            Придбати
                        </button>
                    </div>

                    
                    <div class="product">
                        <img src="{{ url_for('static', filename='NORMAL+ base1.png') }}" alt="Base 5">
                        <img src="{{ url_for('static', filename='NORMAL+ base2.png') }}">
                        <img src="{{ url_for('static', filename='NORMAL+ base3.png') }}">
                        <h3>База NORMAL+</h3>
                        <p>В комплект до бази:</p>
                        <p>Бочка х2, Code Lock, Пачка цвяхів х3, Молоток,</p>
                        <p>Кувалда, Генератор, Будівельна лампа, Катушка.</p>
                        <h3>Увага!</h3>
                        <p>Після оплати замовлення, створіть тікет в</p>
                        <p>Discord, для уточнення даних із адміністрацією.</p>
                        <p class="promo-stock" data-product="BaseDeerisle">Завантаження...</p>
                        <div class="quantity-control">
                            <button class="decrement">-</button>
                              <span class="quantity" data-product-id="61">1</span>
                            <button class="increment">+</button>
                        </div>
                        <h3>Ціна: ₴850</h3>
                        <button class="buy" 
                            data-product-id="61" 
                            data-product-name="NORMAL+ base" 
                            data-product-price="850">
                            Придбати
                        </button>
                    </div>

                    
                    <div class="product">
                        <img src="{{ url_for('static', filename='NORMAL base1.png') }}" alt="Base 6">
                        <img src="{{ url_for('static', filename='NORMAL base2.png') }}">
                        <img src="{{ url_for('static', filename='NORMAL base3.png') }}">
                        <h3>База NORMAL</h3>
                        <p>В комплект до бази:</p>
                        <p>Бочка х2, Code Lock, Пачка цвяхів х3, Молоток,</p>
                        <p>Кувалда, Генератор, Будівельна лампа, Катушка.</p>
                        <h3>Увага!</h3>
                        <p>Після оплати замовлення, створіть тікет в</p>
                        <p>Discord, для уточнення даних із адміністрацією.</p>
                        <p class="promo-stock" data-product="BaseDeerisle">Завантаження...</p>                        
                        <div class="quantity-control">
                            <button class="decrement">-</button>
                              <span class="quantity" data-product-id="62">1</span>
                            <button class="increment">+</button>
                        </div>
                        <h3>Ціна: ₴800</h3>
                        <button class="buy" 
                            data-product-id="62" 
                            data-product-name="NORMAL base" 
                            data-product-price="800">
                            Придбати
                        </button>
                    </div>

                    <div class="product">
                        <img src="{{ url_for('static', filename='MEDIUM+ base1.png') }}" alt="Base 7">
                        <img src="{{ url_for('static', filename='MEDIUM+ base2.png') }}">
                        <img src="{{ url_for('static', filename='MEDIUM+ base3.png') }}">
                        <h3>База MEDIUM+</h3>
                        <p>В комплект до бази:</p>
                        <p>Бочка х2, Code Lock, Пачка цвяхів х3, Молоток,</p>
                        <p>Кувалда, Генератор, Будівельна лампа, Катушка.</p>
                        <h3>Увага!</h3>
                        <p>Після оплати замовлення, створіть тікет в</p>
                        <p>Discord, для уточнення даних із адміністрацією.</p>
                        <p class="promo-stock" data-product="BaseDeerisle">Завантаження...</p>
                        <div class="quantity-control">
                            <button class="decrement">-</button>
                              <span class="quantity" data-product-id="63">1</span>
                            <button class="increment">+</button>
                        </div>
                        <h3>Ціна: ₴650</h3>
                        <button class="buy" 
                            data-product-id="63" 
                            data-product-name="MEDIUM+ base" 
                            data-product-price="650">
                            Придбати
                        </button>
                    </div>

                    <div class="product">
                        <img src="{{ url_for('static', filename='MEDIUM base1.png') }}" alt="Base 8">
                        <img src="{{ url_for('static', filename='MEDIUM base2.png') }}">
                        <img src="{{ url_for('static', filename='MEDIUM base3.png') }}">
                        <h3>База MEDIUM</h3>
                        <p>В комплект до бази:</p>
                        <p>Бочка х2, Code Lock, Пачка цвяхів х3, Молоток,</p>
                        <p>Кувалда, Генератор, Будівельна лампа, Катушка.</p>
                        <h3>Увага!</h3>
                        <p>Після оплати замовлення, створіть тікет в</p>
                        <p>Discord, для уточнення даних із адміністрацією.</p>
                        <p class="promo-stock" data-product="BaseDeerisle">Завантаження...</p>
                        <div class="quantity-control">
                            <button class="decrement">-</button>
                              <span class="quantity" data-product-id="63">1</span>
                            <button class="increment">+</button>
                        </div>
                        <h3>Ціна: ₴600</h3>
                        <button class="buy" 
                            data-product-id="64" 
                            data-product-name="MEDIUM base" 
                            data-product-price="600">
                            Придбати
                        </button>
                    </div>

                    <div class="product">
                        <img src="{{ url_for('static', filename='MINI+ base1.png') }}" alt="Base 9">
                        <img src="{{ url_for('static', filename='MINI+ base2.png') }}">
                        <img src="{{ url_for('static', filename='MINI+ base3.png') }}">
                        <h3>База MINI+</h3>
                        <p>В комплект до бази:</p>
                        <p>Бочка х2, Code Lock, Пачка цвяхів х3, Молоток,</p>
                        <p>Кувалда, Генератор, Будівельна лампа, Катушка.</p>
                        <h3>Увага!</h3>
                        <p>Після оплати замовлення, створіть тікет в</p>
                        <p>Discord, для уточнення даних із адміністрацією.</p>
                        <p class="promo-stock" data-product="BaseDeerisle">Завантаження...</p>
                        <div class="quantity-control">
                            <button class="decrement">-</button>
                              <span class="quantity" data-product-id="65">1</span>
                            <button class="increment">+</button>
                        </div>
                        <h3>Ціна: ₴450</h3>
                        <button class="buy" 
                            data-product-id="65" 
                            data-product-name="MINI+ base" 
                            data-product-price="450">
                            Придбати
                        </button>
                    </div>

                    <div class="product">
                        <img src="{{ url_for('static', filename='MINI base1.png') }}" alt="Base 10">
                        <img src="{{ url_for('static', filename='MINI base2.png') }}">
                        <img src="{{ url_for('static', filename='MINI base3.png') }}">
                        <h3>База MINI</h3>
                        <p>В комплект до бази:</p>
                        <p>Бочка х2, Code Lock, Пачка цвяхів х3, Молоток,</p>
                        <p>Кувалда, Генератор, Будівельна лампа, Катушка.</p>
                        <h3>Увага!</h3>
                        <p>Після оплати замовлення, створіть тікет в</p>
                        <p>Discord, для уточнення даних із адміністрацією.</p>
                        <p class="promo-stock" data-product="BaseDeerisle">Завантаження...</p>                       
                        <div class="quantity-control">
                            <button class="decrement">-</button>
                              <span class="quantity" data-product-id="66">1</span>
                            <button class="increment">+</button>
                        </div>
                        <h3>Ціна: ₴400</h3>
                        <button class="buy" 
                            data-product-id="66" 
                            data-product-name="MINI base" 
                            data-product-price="400">
                            Придбати
                        </button>
                    </div>

                </div>
            </section>
    
        </main>
    
        <footer>
            <p>&copy; 2025 Магазин DayZ APEXIA Project. Усі права захищені.</p>
        </footer>
        <script src="{{ url_for('static', filename='main.js') }}"></script>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const buyButtons = document.querySelectorAll('.buy');
                const stockElements = document.querySelectorAll(".promo-stock");
            
                // Додавання товару в базу
                buyButtons.forEach(button => {
                    button.addEventListener('click', async () => {
                        const productName = button.getAttribute('data-product-name');
                        const productPrice = button.getAttribute('data-product-price');
            
                        try {
                            const response = await fetch('/product/add', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ name: productName, price: parseFloat(productPrice) })
                            });
            
                            const data = await response.json();
                            if (response.ok && data.success) {
                                alert(`Товар "${productName}" додано до бази з ID: ${data.product_id}`);
                            } else {
                                alert(`Помилка: ${data.message || 'Невідома помилка'}`);
                            }
                        } catch (error) {
                            console.error('Помилка запиту:', error);
                            alert('Помилка з\'єднання з сервером.');
                        }
                    });
                });
            
                // Оновлення кількості доступних промокодів
                stockElements.forEach(async (el) => {
                    const productName = el.getAttribute("data-product");
            
                    try {
                        const response = await fetch(`/promo_stock?product=${encodeURIComponent(productName)}`);
                        const data = await response.json();
            
                        if (response.ok && data.success) {
                            el.textContent = `В наявності: ${data.remaining}`;
                        } else {
                            el.textContent = "Помилка отримання даних";
                        }
                    } catch (error) {
                        el.textContent = "Помилка з'єднання";
                    }
                });
            });
            </script>        
    </body>
    </html>